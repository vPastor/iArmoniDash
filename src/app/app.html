<!-- LOGIN -->
<div *ngIf="!isAuthenticated">
  <h1>Login bÃ¡sico ğŸ”</h1>
  <input type="text" placeholder="Usuario" [(ngModel)]="user" />
  <input type="password" placeholder="ContraseÃ±a" [(ngModel)]="pass" />
  <button (click)="probarApi()">Iniciar sesiÃ³n</button>
  <p *ngIf="isLoading">ğŸ”„ Cargando datosâ€¦</p>
  <p *ngIf="!isLoading && apiRespuesta?.error" style="color: red;">
    âŒ Error: {{ apiRespuesta.error }}
  </p>
</div>

<!-- DASHBOARD -->
<div *ngIf="isAuthenticated">
  <button (click)="logout()" style="float: right;">ğŸšª Cerrar sesiÃ³n</button>

</div>

<!-- Solo mostrar el dashboard si hay respuesta vÃ¡lida -->
<div *ngIf="!isLoading && apiRespuesta && !apiRespuesta.error">
  <hr />
  
  <h2>Resumen del Dashboard</h2>

  <div class="kpis">
    <div class="kpi">
      <h3>Total de Ã­tems</h3>
      <p>{{ apiRespuesta.total_items }}</p>
    </div>
    <div class="kpi">
      <h3>Ãtems faltantes</h3>
      <p>{{ apiRespuesta.total_missing_items }}</p>
    </div>
    <div class="kpi">
      <h3>Procedimientos totales</h3>
      <p>{{ apiRespuesta.total_procedures }}</p>
    </div>
  </div>

  <h3>Procedimientos por mes:</h3>
  <table border="1" cellpadding="5">
    <tr><th>Mes</th><th>Cantidad</th></tr>
    <tr *ngFor="let mes of obtenerProceduresPorMes()">
      <td>{{ mes.mes }}</td>
      <td>{{ mes.valor }}</td>
    </tr>
  </table>

  <h3>GrÃ¡fico de procedimientos por mes:</h3>
  <canvas
    baseChart
    [data]="chartData"
    [type]="'bar'"
    [options]="chartOptions">
  </canvas>
</div>
<!-- Filtro por mes -->
<div *ngIf="apiRespuesta && !apiRespuesta.error" style="margin: 0.5rem 0;">
  <label for="mes">Filtrar por mes: </label>
  <select id="mes" [(ngModel)]="selectedMonth" (ngModelChange)="onMonthChange()">
    <option [ngValue]="null">Todos</option>
    <option *ngFor="let kv of apiRespuesta?.procedures_per_month | keyvalue" [value]="kv.key">
      {{ kv.key }}
    </option>
  </select>
</div>

<!-- Seguimos dejando el JSON de debug visible -->
<pre>{{ apiRespuesta | json }}</pre>